# ë©€í‹°í”Œë ˆì´ ê²Œì„ì„œë²„

### í”„ë¡œì íŠ¸ ì†Œê°œ

tcpë¥¼ ì´ìš©í•˜ì—¬ ë©€í‹°í”Œë ˆì´ ê²Œì„ ì„œë²„ë¥¼ êµ¬í˜„í•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
tcp_mutigame
ğŸ“¦src
 â”£ ğŸ“‚classes
 â”ƒ â”£ ğŸ“‚managers
 â”ƒ â”ƒ â”— ğŸ“œlatency.manager.js
 â”ƒ â”— ğŸ“‚models
 â”ƒ â”ƒ â”£ ğŸ“œgame.class.js
 â”ƒ â”ƒ â”— ğŸ“œuser.class.js
 â”£ ğŸ“‚config
 â”ƒ â”— ğŸ“œconfig.js
 â”£ ğŸ“‚constants
 â”ƒ â”£ ğŸ“‚codes
 â”ƒ â”ƒ â”£ ğŸ“œerrorCodes.js
 â”ƒ â”ƒ â”— ğŸ“œresponseCode.js
 â”ƒ â”£ ğŸ“œenv.js
 â”ƒ â”£ ğŸ“œhandlerId.js
 â”ƒ â”— ğŸ“œheader.js
 â”£ ğŸ“‚db
 â”ƒ â”£ ğŸ“‚migration
 â”ƒ â”ƒ â”— ğŸ“œcreateSchemas.js
 â”ƒ â”£ ğŸ“‚sql
 â”ƒ â”ƒ â”— ğŸ“œuser_db.sql
 â”ƒ â”£ ğŸ“‚user
 â”ƒ â”ƒ â”£ ğŸ“œuser.db.js
 â”ƒ â”ƒ â”— ğŸ“œuser.querise.js
 â”ƒ â”— ğŸ“œdatabase.js
 â”£ ğŸ“‚events
 â”ƒ â”£ ğŸ“œonConnection.js
 â”ƒ â”£ ğŸ“œonData.js
 â”ƒ â”£ ğŸ“œonEnd.js
 â”ƒ â”— ğŸ“œonError.js
 â”£ ğŸ“‚handlers
 â”ƒ â”£ ğŸ“‚game
 â”ƒ â”ƒ â”— ğŸ“œlocationUpdate.handler.js
 â”ƒ â”£ ğŸ“‚user
 â”ƒ â”ƒ â”— ğŸ“œinitial.handler.js
 â”ƒ â”— ğŸ“œindex.js
 â”£ ğŸ“‚init
 â”ƒ â”£ ğŸ“œindex.js
 â”ƒ â”— ğŸ“œloadProtos.js
 â”£ ğŸ“‚protobuf
 â”ƒ â”£ ğŸ“‚notification
 â”ƒ â”ƒ â”— ğŸ“œgame.notification.proto
 â”ƒ â”£ ğŸ“‚request
 â”ƒ â”ƒ â”£ ğŸ“œcommon.proto
 â”ƒ â”ƒ â”£ ğŸ“œgame.proto
 â”ƒ â”ƒ â”— ğŸ“œinitial.proto
 â”ƒ â”£ ğŸ“‚response
 â”ƒ â”ƒ â”— ğŸ“œresponse.proto
 â”ƒ â”— ğŸ“œpacketNames.js
 â”£ ğŸ“‚session
 â”ƒ â”£ ğŸ“œgame.session.js
 â”ƒ â”£ ğŸ“œsession.js
 â”ƒ â”— ğŸ“œuser.session.js
 â”£ ğŸ“‚utils
 â”ƒ â”£ ğŸ“‚error
 â”ƒ â”ƒ â”£ ğŸ“œcustomError.js
 â”ƒ â”ƒ â”— ğŸ“œerrorHandler.js
 â”ƒ â”£ ğŸ“‚notigication
 â”ƒ â”ƒ â”— ğŸ“œgame.notification.js
 â”ƒ â”£ ğŸ“‚parser
 â”ƒ â”ƒ â”— ğŸ“œpacketParser.js
 â”ƒ â”£ ğŸ“‚response
 â”ƒ â”ƒ â”£ ğŸ“œcreateResponse.js
 â”ƒ â”ƒ â”— ğŸ“œtransformCase.js
 â”ƒ â”— ğŸ“œdateFomatter.js
 â”— ğŸ“œserver.js
```

### íŒ¨í‚· êµ¬ì¡°

**ë°”ì´íŠ¸ êµ¬ì¡°**
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… | í¬ê¸° |
| ----------- | -------- | -------------------- | ----- |
| totalLength | int | ë©”ì„¸ì§€ì˜ ì „ì²´ ê¸¸ì´ | 4Byte |
| packetType | int | íŒ¨í‚·ì˜ íƒ€ì… | 1Byte |
| protobuf | protobuf | í”„ë¡œí† ì½œ ë²„í¼ êµ¬ì¡°ì²´ | ê°€ë³€ |

### í”„ë¡œí†  ë²„í”„ êµ¬ì¡°

**common** <br>
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… |
| ------------- | ------ | ------------------------ |
| handlerId | uint32 | í•¸ë“¤ëŸ¬ ID (4ë°”ì´íŠ¸) |
| userId | string | ìœ ì € ID (UUID) |
| version | string | í´ë¼ì´ì–¸íŠ¸ ë²„ì „ (ë¬¸ìì—´) |
| payload | bytes | ì‹¤ì œ ë°ì´í„° |

**LocationUpdatePayload** <br>
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… |
| ------------- | ------ | ------------------------ |
| x | float | ìœ ì €ì˜ xì¢Œí‘œ |
| y | float | ìœ ì €ì˜ yì¢Œí‘œ |

**InitialPayload** <br>
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… |
| ------------- | ------ | ------------------------ |
| deviceId | string | ìœ ì € ID (UUID) |
| playerId | uint32 | ìºë¦­í„° id |
| latency | float | ì§€ì—°ì‹œê°„ |

**LocationUpdate** <br>
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… |
| ------------- | ------ | ------------------------ |
| users | repeated UserLocation | ì—¬ëŸ¬ ìœ ì € ì •ë³´ |

**UserLocation** <br>
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… |
| ------------- | ------ | ------------------------ |
| id | string | ìœ ì € ID (UUID) |
| playerId | uint32 | ìºë¦­í„° id |
| x | float | ìœ ì €ì˜ xì¢Œí‘œ |
| y | float | ìœ ì €ì˜ yì¢Œí‘œ |

**Response** <br>
| í•„ë“œ ëª… | íƒ€ì… | ì„¤ëª… |
| ------------ | ------ | ---------------------------------------------- |
| handlerId | uint32 | í•¸ë“¤ëŸ¬ ID |
| responseCode | uint32 | ì‘ë‹µ ì½”ë“œ (ì„±ê³µ: 0, ì‹¤íŒ¨: ì—ëŸ¬ ì½”ë“œ) |
| timestamp | int64 | ë©”ì‹œì§€ ìƒì„± íƒ€ì„ìŠ¤íƒ¬í”„ (Unix íƒ€ì„ìŠ¤íƒ¬í”„) |
| data | bytes | ì‹¤ì œ ì‘ë‹µ ë°ì´í„° (ì„ íƒì  í•„ë“œ) |
| sequence | uint32 | ì‹œí€€ìŠ¤ ê°’ (í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.) |

### ë¼ì´ë¸ŒëŸ¬ë¦¬

- dotenv: í™˜ê²½ë³€ìˆ˜ íŒŒì¼ .env íŒŒì¼ë¡œë¶€í„° í™˜ê²½ë³€ìˆ˜ ì •ë³´ë¥¼ ì½ê³ , í•´ë‹¹ í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
  - í™˜ê²½ë³€ìˆ˜ ê°’ë“¤ì€ process.envì— í• ë‹¹ë©ë‹ˆë‹¤.
- lodash: í•´ë‹¹ ë³€ìˆ˜ë‚˜ ì´ë¦„ì„ ì—¬ëŸ¬í˜•íƒœì˜ ì¼€ì´ìŠ¤(ì¹´ë©œ ì¼€ì´ìŠ¤, ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤...ë“±)ìœ¼ë¡œ ë³€í™˜í•´ ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
- mysql2: mysqlì„ ì´ìš©í•˜ì—¬ ì»¤ë„¥ì…˜ í’€ì„ ê´€ë¦¬í•  ìˆ˜ ìˆê³  sqlë¬¸ë²•ë„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
- protobufjs: í”„ë¡œí†  íŒŒì¼ë“¤ì„ ì§ë ¬í™”ì™€ ì—­ì§ë ¬í™”í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
- uuid: ê³ ìœ í•œ uuidë¥¼ ìƒì„±í•´ ì¤„ë•Œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. í˜„ì¬ ì„œë²„ì—ì„œ í…ŒìŠ¤íŠ¸ë¡œ uuidë¥¼ ìƒì„±í•˜ì—¬ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. (ì‹¤ì œ í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í›„ uuidë¥¼ ë„˜ê²¨ì¤ë‹ˆë‹¤.)

**ê°œë°œ ë¼ì´ë¸ŒëŸ¬ë¦¬**

- prettier: ì½”ë“œë¥¼ ì¼ê´€ì„± ìˆê²Œ ì„¤ì •í•œ ê°’ìœ¼ë¡œ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ ì£¼ì–´ ì½”ë“œì˜ ê°€ë…ì„±ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
- nodemon: í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰ ì¤‘ ìë™ìœ¼ë¡œ ì½”ë“œê°€ ìˆ˜ì •ëœ ê²ƒì„ ì¸ì‹í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì¬ì‹¤í–‰í•˜ì—¬ ê°œë°œì†ë„ë¥¼ ë†’í˜€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
